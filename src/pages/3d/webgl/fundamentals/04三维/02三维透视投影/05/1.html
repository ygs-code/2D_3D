<html><head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>WebGL - Frustum Diagram</title>
  <link type="text/css" href="resources/webgl-tutorials.css" rel="stylesheet">
  <style>
  #canvas {
      width: 400px;
      height: 600px;
  }
  @media (prefers-color-scheme: dark) {
    canvas { 
      background: #444;
    }
  }
  </style>
<style type="text/css">.cyxy-trs-target.colored {
background-color: rgba(0, 185, 119, 0.05);
}

.cyxy-target-popup {
padding: 1.3rem 12px;
position: absolute;
display: -webkit-flex;
display: inline-flex;
flex-direction: row;
overflow: scroll;
vertical-align: middle;
z-index: 199099;
top: 1px;
left: 1px;
background: #fff;
opacity: 0.98;
/*margin: 0px 5%;*/
height: auto;
width: auto;
border: 1px solid #e6e6e6;
box-shadow: 0 0 8px 0 rgba(0, 0, 0, 0.13);
border-radius: 5px;
/*height: 7rem;*/
}

@media (max-width: 468px) {
.cyxy-target-popup {
  /*width: 90%;*/
  /*margin: 0px 5%;*/
  left: 10%;
  /*right: 5%;*/
  /*width: 30rem;*/
  /*height: 14.58rem;*/
}
}

#cyxy-popup-left-slide {
height: 22px;
display: inline;
vertical-align: middle;
margin-right: 14px;
cursor: pointer;
}

#cyxy-popup-right-slide {
height: 22px;
display: inline;
vertical-align: middle;
margin-left: 0px;
cursor: pointer;
}

#cyxy-popup-userinfo {
display: inline;
}

.cyxy-target-count {
display: inline;
vertical-align: middle;
font-size: 10px;
}

#cyxy-popup-avatar {
/*margin-right: 30px;*/
/*font-size: 14px;*/
display: inline;
height: 32px;
vertical-align: middle;
border-radius: 16px;
}

#cyxy-popup-name-time {
display: -webkit-flex;
display: inline-flex;
flex-direction: column;
/*align-items: center;*/
/*position: relative;*/
vertical-align: middle;
text-align: left;
margin-left: 6px;
}

#cyxy-popup-name {
/*vertical-align: middle;*/
/*display: flex;*/
font-size: 14px;
color: #333;
height: 18px;
overflow: hidden;
max-width: 84px;
}

#cyxy-popup-time {
/*margin-right: 30px;*/
/*font-size: 14px;*/
/*display: flex;*/
font-size: 12px;
margin-top: 4px;
color: #999;
}

.cyxy-footer {
display: none;
position: fixed;
bottom: 0px;
padding: 0px 0px;
left: 0;
right: 0;
margin: auto;
opacity: 0.9;
border: 1px solid #e6e6e6;
box-shadow: 0 0 8px 0 rgba(0, 0, 0, 0.13);
border-radius: 2px;
z-index: 201712;
text-align: center;
}

.cyxy-footer-p {
padding: 12px 0px;
margin: 0px;
font-size: 12px;
color: #333;
background: #fff;
text-align: center;
line-height: 1.6;
font-weight: 200;
}

#cyxy-popup-favour {
text-align: center;
display: inline;
margin-right: 20px;
margin-left: 46px;
cursor: pointer;
}

#cyxy-popup-favour.commit {
/*padding: 2px 6px;*/
/*border: 1px solid #00B977;*/
/*border-radius: 4px;*/
}

#cyxy-popup-oppose {
text-align: center;
display: inline;
cursor: pointer;
}

#cyxy-popup-favour-img {
display: inline;
height: 20px;
/*width: 22px;*/
vertical-align: middle;
}

#cyxy-popup-favour-img.commit {
/*height: 22px;*/
/*vertical-align: middle;*/
}

#cyxy-popup-oppose-img {
display: inline;
height: 18px;
vertical-align: middle;
}

#cyxy-popup-favour-num {
font-size: 14px;
margin-left: 4px;
/*margin-left: 0.47rem;*/
color: #999999;
}

#cyxy-popup-oppose-num {
font-size: 14px;
margin-left: 4px;
/*margin-left: 0.47rem;*/
color: #999;
}

.caption-window.ytp-caption-window-bottom {
width: 800px;
/* height: 100px; */
/* margin-left: -400px; */
}

@media (max-width: 320px) {
#cyxy-popup-favour {
  margin-right: 0.8rem;
  margin-left: 1.5rem;
}

#cyxy-popup-left-slide {
  margin-right: 0.8rem;
}

#cyxy-popup-right-slide {
  margin-left: 1rem;
}
}

.login-hint-a {
border-bottom: none;
display: block;
color: #999;
font-size: 10px;
}

.login-hint-a:visited {
color: #999;
}

.layui-m-layer {
color: #333;
position: relative;
z-index: 2147483647;
}

.layui-m-layer * {
-webkit-box-sizing: content-box;
-moz-box-sizing: content-box;
box-sizing: content-box;
}

.layui-m-layermain,
.layui-m-layershade {
position: fixed;
left: 0;
top: 0;
width: 100%;
height: 100%;
}

.layui-m-layershade {
background-color: rgba(0, 0, 0, 0.7);
pointer-events: auto;
}

.layui-m-layermain {
display: table;
font-family: Helvetica, arial, sans-serif;
pointer-events: none;
}

.layui-m-layermain .layui-m-layersection {
display: table-cell;
vertical-align: middle;
text-align: center;
}

.layui-m-layerchild {
position: relative;
display: inline-block;
text-align: left;
background-color: #fff;
font-size: 14px;
border-radius: 5px;
box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);
pointer-events: auto;
-webkit-overflow-scrolling: touch;
-webkit-animation-fill-mode: both;
animation-fill-mode: both;
-webkit-animation-duration: 0.2s;
animation-duration: 0.2s;
}

@-webkit-keyframes layui-m-anim-scale {
0% {
  opacity: 0;
  -webkit-transform: scale(0.5);
  transform: scale(0.5);
}
100% {
  opacity: 1;
  -webkit-transform: scale(1);
  transform: scale(1);
}
}

@keyframes layui-m-anim-scale {
0% {
  opacity: 0;
  -webkit-transform: scale(0.5);
  transform: scale(0.5);
}
100% {
  opacity: 1;
  -webkit-transform: scale(1);
  transform: scale(1);
}
}

.layui-m-anim-scale {
animation-name: layui-m-anim-scale;
-webkit-animation-name: layui-m-anim-scale;
}

@-webkit-keyframes layui-m-anim-up {
0% {
  opacity: 0;
  -webkit-transform: translateY(800px);
  transform: translateY(800px);
}
100% {
  opacity: 1;
  -webkit-transform: translateY(0);
  transform: translateY(0);
}
}

@keyframes layui-m-anim-up {
0% {
  opacity: 0;
  -webkit-transform: translateY(800px);
  transform: translateY(800px);
}
100% {
  opacity: 1;
  -webkit-transform: translateY(0);
  transform: translateY(0);
}
}

.layui-m-anim-up {
-webkit-animation-name: layui-m-anim-up;
animation-name: layui-m-anim-up;
}

.layui-m-layer0 .layui-m-layerchild {
width: 90%;
max-width: 640px;
}

.layui-m-layer1 .layui-m-layerchild {
border: none;
border-radius: 0;
}

.layui-m-layer2 .layui-m-layerchild {
width: auto;
max-width: 260px;
min-width: 40px;
border: none;
background: 0 0;
box-shadow: none;
color: #fff;
}

.layui-m-layerchild h3 {
padding: 0 10px;
height: 60px;
line-height: 60px;
font-size: 16px;
font-weight: 400;
border-radius: 5px 5px 0 0;
text-align: center;
}

.layui-m-layerbtn span,
.layui-m-layerchild h3 {
margin: 0;
padding: 0;
text-overflow: ellipsis;
overflow: hidden;
white-space: nowrap;
}

.layui-m-layercont {
padding: 50px 30px;
line-height: 22px;
text-align: center;
}

.layui-m-layer1 .layui-m-layercont {
padding: 0;
text-align: left;
}

.layui-m-layer2 .layui-m-layercont {
text-align: center;
padding: 0;
line-height: 0;
}

.layui-m-layer2 .layui-m-layercont i {
width: 25px;
height: 25px;
margin-left: 8px;
display: inline-block;
background-color: #fff;
border-radius: 100%;
-webkit-animation: layui-m-anim-loading 1.4s infinite ease-in-out;
animation: layui-m-anim-loading 1.4s infinite ease-in-out;
-webkit-animation-fill-mode: both;
animation-fill-mode: both;
}

.layui-m-layerbtn,
.layui-m-layerbtn span {
position: relative;
text-align: center;
border-radius: 0 0 5px 5px;
}

.layui-m-layer2 .layui-m-layercont p {
margin-top: 20px;
}

@-webkit-keyframes layui-m-anim-loading {
0%,
100%,
80% {
  transform: scale(0);
  -webkit-transform: scale(0);
}
40% {
  transform: scale(1);
  -webkit-transform: scale(1);
}
}

@keyframes layui-m-anim-loading {
0%,
100%,
80% {
  transform: scale(0);
  -webkit-transform: scale(0);
}
40% {
  transform: scale(1);
  -webkit-transform: scale(1);
}
}

.layui-m-layer2 .layui-m-layercont i:first-child {
margin-left: 0;
-webkit-animation-delay: -0.32s;
animation-delay: -0.32s;
}

.layui-m-layer2 .layui-m-layercont i.layui-m-layerload {
-webkit-animation-delay: -0.16s;
animation-delay: -0.16s;
}

.layui-m-layer2 .layui-m-layercont > div {
line-height: 22px;
padding-top: 7px;
margin-bottom: 20px;
font-size: 14px;
}

.layui-m-layerbtn {
display: box;
display: -moz-box;
display: -webkit-box;
width: 100%;
height: 50px;
line-height: 50px;
font-size: 0;
border-top: 1px solid #d0d0d0;
background-color: #f2f2f2;
}

.layui-m-layerbtn span {
display: block;
-moz-box-flex: 1;
box-flex: 1;
-webkit-box-flex: 1;
font-size: 14px;
cursor: pointer;
}

.layui-m-layerbtn span[yes] {
color: #40affe;
}

.layui-m-layerbtn span[no] {
border-right: 1px solid #d0d0d0;
border-radius: 0 0 0 5px;
}

.layui-m-layerbtn span:active {
background-color: #f6f6f6;
}

.layui-m-layerend {
position: absolute;
right: 7px;
top: 10px;
width: 30px;
height: 30px;
border: 0;
font-weight: 400;
background: 0 0;
cursor: pointer;
-webkit-appearance: none;
font-size: 30px;
}

.layui-m-layerend::after,
.layui-m-layerend::before {
position: absolute;
left: 5px;
top: 15px;
content: "";
width: 18px;
height: 1px;
background-color: #999;
transform: rotate(45deg);
-webkit-transform: rotate(45deg);
border-radius: 3px;
}

.layui-m-layerend::after {
transform: rotate(-45deg);
-webkit-transform: rotate(-45deg);
}

.layui-m-layer .layui-m-layer-footer {
position: fixed;
width: 95%;
max-width: 100%;
margin: 0 auto;
left: 0;
right: 0;
bottom: 10px;
background: 0 0;
}

.layui-m-layer-footer .layui-m-layercont {
padding: 20px;
border-radius: 5px 5px 0 0;
background-color: rgba(255, 255, 255, 0.8);
}

.layui-m-layer-footer .layui-m-layerbtn {
display: block;
height: auto;
background: 0 0;
border-top: none;
}

.layui-m-layer-footer .layui-m-layerbtn span {
background-color: rgba(255, 255, 255, 0.8);
}

.layui-m-layer-footer .layui-m-layerbtn span[no] {
color: #fd482c;
border-top: 1px solid #c2c2c2;
border-radius: 0 0 5px 5px;
}

.layui-m-layer-footer .layui-m-layerbtn span[yes] {
margin-top: 10px;
border-radius: 5px;
}

.layui-m-layer .layui-m-layer-msg {
width: auto;
max-width: 90%;
margin: 0 auto;
bottom: -150px;
background-color: rgba(0, 0, 0, 0.7);
color: #fff;
}

.layui-m-layer-msg .layui-m-layercont {
padding: 10px 20px;
}

.collection-success {
/*opacity: 0.6;*/
/*background: #EAEAEA;*/
color: #ffffff;
}
.collection-success:hover {
/*opacity: 0.45;*/
/*background: #000000;*/
color: #ffffff;
}
.layui-m-layercont .cyxy-trs-target {
display: none;
}
.collection-icon {
width: 12px;
height: 13px;
background: url("data:image/png;base64,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")
  no-repeat;
display: inline-block;
background-size: cover;
background-position: center;
}
.collection-success > a {
margin-left: 12px;
vertical-align: middle;
}
.cy_free_box {
position: relative;
}
.cy_free_box img {
width: 100%;
cursor: pointer;
-moz-user-select: none; /*火狐*/
-webkit-user-select: none; /*webkit浏览器*/
-ms-user-select: none; /*IE10*/
-khtml-user-select: none; /*早期浏览器*/
user-select: none;
}
.layui-m-layer-cy_free_content {
background: inherit !important;
}
</style><style type="text/css">.cyxy-trs-target.colored {
background-color: rgba(0, 185, 119, 0.05);
}

.cyxy-target-popup {
padding: 1.3rem 12px;
position: absolute;
display: -webkit-flex;
display: inline-flex;
flex-direction: row;
overflow: scroll;
vertical-align: middle;
z-index: 199099;
top: 1px;
left: 1px;
background: #fff;
opacity: 0.98;
/*margin: 0px 5%;*/
height: auto;
width: auto;
border: 1px solid #e6e6e6;
box-shadow: 0 0 8px 0 rgba(0, 0, 0, 0.13);
border-radius: 5px;
/*height: 7rem;*/
}

@media (max-width: 468px) {
.cyxy-target-popup {
  /*width: 90%;*/
  /*margin: 0px 5%;*/
  left: 10%;
  /*right: 5%;*/
  /*width: 30rem;*/
  /*height: 14.58rem;*/
}
}

#cyxy-popup-left-slide {
height: 22px;
display: inline;
vertical-align: middle;
margin-right: 14px;
cursor: pointer;
}

#cyxy-popup-right-slide {
height: 22px;
display: inline;
vertical-align: middle;
margin-left: 0px;
cursor: pointer;
}

#cyxy-popup-userinfo {
display: inline;
}

.cyxy-target-count {
display: inline;
vertical-align: middle;
font-size: 10px;
}

#cyxy-popup-avatar {
/*margin-right: 30px;*/
/*font-size: 14px;*/
display: inline;
height: 32px;
vertical-align: middle;
border-radius: 16px;
}

#cyxy-popup-name-time {
display: -webkit-flex;
display: inline-flex;
flex-direction: column;
/*align-items: center;*/
/*position: relative;*/
vertical-align: middle;
text-align: left;
margin-left: 6px;
}

#cyxy-popup-name {
/*vertical-align: middle;*/
/*display: flex;*/
font-size: 14px;
color: #333;
height: 18px;
overflow: hidden;
max-width: 84px;
}

#cyxy-popup-time {
/*margin-right: 30px;*/
/*font-size: 14px;*/
/*display: flex;*/
font-size: 12px;
margin-top: 4px;
color: #999;
}

.cyxy-footer {
display: none;
position: fixed;
bottom: 0px;
padding: 0px 0px;
left: 0;
right: 0;
margin: auto;
opacity: 0.9;
border: 1px solid #e6e6e6;
box-shadow: 0 0 8px 0 rgba(0, 0, 0, 0.13);
border-radius: 2px;
z-index: 201712;
text-align: center;
}

.cyxy-footer-p {
padding: 12px 0px;
margin: 0px;
font-size: 12px;
color: #333;
background: #fff;
text-align: center;
line-height: 1.6;
font-weight: 200;
}

#cyxy-popup-favour {
text-align: center;
display: inline;
margin-right: 20px;
margin-left: 46px;
cursor: pointer;
}

#cyxy-popup-favour.commit {
/*padding: 2px 6px;*/
/*border: 1px solid #00B977;*/
/*border-radius: 4px;*/
}

#cyxy-popup-oppose {
text-align: center;
display: inline;
cursor: pointer;
}

#cyxy-popup-favour-img {
display: inline;
height: 20px;
/*width: 22px;*/
vertical-align: middle;
}

#cyxy-popup-favour-img.commit {
/*height: 22px;*/
/*vertical-align: middle;*/
}

#cyxy-popup-oppose-img {
display: inline;
height: 18px;
vertical-align: middle;
}

#cyxy-popup-favour-num {
font-size: 14px;
margin-left: 4px;
/*margin-left: 0.47rem;*/
color: #999999;
}

#cyxy-popup-oppose-num {
font-size: 14px;
margin-left: 4px;
/*margin-left: 0.47rem;*/
color: #999;
}

.caption-window.ytp-caption-window-bottom {
width: 800px;
/* height: 100px; */
/* margin-left: -400px; */
}

@media (max-width: 320px) {
#cyxy-popup-favour {
  margin-right: 0.8rem;
  margin-left: 1.5rem;
}

#cyxy-popup-left-slide {
  margin-right: 0.8rem;
}

#cyxy-popup-right-slide {
  margin-left: 1rem;
}
}

.login-hint-a {
border-bottom: none;
display: block;
color: #999;
font-size: 10px;
}

.login-hint-a:visited {
color: #999;
}

.layui-m-layer {
color: #333;
position: relative;
z-index: 2147483647;
}

.layui-m-layer * {
-webkit-box-sizing: content-box;
-moz-box-sizing: content-box;
box-sizing: content-box;
}

.layui-m-layermain,
.layui-m-layershade {
position: fixed;
left: 0;
top: 0;
width: 100%;
height: 100%;
}

.layui-m-layershade {
background-color: rgba(0, 0, 0, 0.7);
pointer-events: auto;
}

.layui-m-layermain {
display: table;
font-family: Helvetica, arial, sans-serif;
pointer-events: none;
}

.layui-m-layermain .layui-m-layersection {
display: table-cell;
vertical-align: middle;
text-align: center;
}

.layui-m-layerchild {
position: relative;
display: inline-block;
text-align: left;
background-color: #fff;
font-size: 14px;
border-radius: 5px;
box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);
pointer-events: auto;
-webkit-overflow-scrolling: touch;
-webkit-animation-fill-mode: both;
animation-fill-mode: both;
-webkit-animation-duration: 0.2s;
animation-duration: 0.2s;
}

@-webkit-keyframes layui-m-anim-scale {
0% {
  opacity: 0;
  -webkit-transform: scale(0.5);
  transform: scale(0.5);
}
100% {
  opacity: 1;
  -webkit-transform: scale(1);
  transform: scale(1);
}
}

@keyframes layui-m-anim-scale {
0% {
  opacity: 0;
  -webkit-transform: scale(0.5);
  transform: scale(0.5);
}
100% {
  opacity: 1;
  -webkit-transform: scale(1);
  transform: scale(1);
}
}

.layui-m-anim-scale {
animation-name: layui-m-anim-scale;
-webkit-animation-name: layui-m-anim-scale;
}

@-webkit-keyframes layui-m-anim-up {
0% {
  opacity: 0;
  -webkit-transform: translateY(800px);
  transform: translateY(800px);
}
100% {
  opacity: 1;
  -webkit-transform: translateY(0);
  transform: translateY(0);
}
}

@keyframes layui-m-anim-up {
0% {
  opacity: 0;
  -webkit-transform: translateY(800px);
  transform: translateY(800px);
}
100% {
  opacity: 1;
  -webkit-transform: translateY(0);
  transform: translateY(0);
}
}

.layui-m-anim-up {
-webkit-animation-name: layui-m-anim-up;
animation-name: layui-m-anim-up;
}

.layui-m-layer0 .layui-m-layerchild {
width: 90%;
max-width: 640px;
}

.layui-m-layer1 .layui-m-layerchild {
border: none;
border-radius: 0;
}

.layui-m-layer2 .layui-m-layerchild {
width: auto;
max-width: 260px;
min-width: 40px;
border: none;
background: 0 0;
box-shadow: none;
color: #fff;
}

.layui-m-layerchild h3 {
padding: 0 10px;
height: 60px;
line-height: 60px;
font-size: 16px;
font-weight: 400;
border-radius: 5px 5px 0 0;
text-align: center;
}

.layui-m-layerbtn span,
.layui-m-layerchild h3 {
margin: 0;
padding: 0;
text-overflow: ellipsis;
overflow: hidden;
white-space: nowrap;
}

.layui-m-layercont {
padding: 50px 30px;
line-height: 22px;
text-align: center;
}

.layui-m-layer1 .layui-m-layercont {
padding: 0;
text-align: left;
}

.layui-m-layer2 .layui-m-layercont {
text-align: center;
padding: 0;
line-height: 0;
}

.layui-m-layer2 .layui-m-layercont i {
width: 25px;
height: 25px;
margin-left: 8px;
display: inline-block;
background-color: #fff;
border-radius: 100%;
-webkit-animation: layui-m-anim-loading 1.4s infinite ease-in-out;
animation: layui-m-anim-loading 1.4s infinite ease-in-out;
-webkit-animation-fill-mode: both;
animation-fill-mode: both;
}

.layui-m-layerbtn,
.layui-m-layerbtn span {
position: relative;
text-align: center;
border-radius: 0 0 5px 5px;
}

.layui-m-layer2 .layui-m-layercont p {
margin-top: 20px;
}

@-webkit-keyframes layui-m-anim-loading {
0%,
100%,
80% {
  transform: scale(0);
  -webkit-transform: scale(0);
}
40% {
  transform: scale(1);
  -webkit-transform: scale(1);
}
}

@keyframes layui-m-anim-loading {
0%,
100%,
80% {
  transform: scale(0);
  -webkit-transform: scale(0);
}
40% {
  transform: scale(1);
  -webkit-transform: scale(1);
}
}

.layui-m-layer2 .layui-m-layercont i:first-child {
margin-left: 0;
-webkit-animation-delay: -0.32s;
animation-delay: -0.32s;
}

.layui-m-layer2 .layui-m-layercont i.layui-m-layerload {
-webkit-animation-delay: -0.16s;
animation-delay: -0.16s;
}

.layui-m-layer2 .layui-m-layercont > div {
line-height: 22px;
padding-top: 7px;
margin-bottom: 20px;
font-size: 14px;
}

.layui-m-layerbtn {
display: box;
display: -moz-box;
display: -webkit-box;
width: 100%;
height: 50px;
line-height: 50px;
font-size: 0;
border-top: 1px solid #d0d0d0;
background-color: #f2f2f2;
}

.layui-m-layerbtn span {
display: block;
-moz-box-flex: 1;
box-flex: 1;
-webkit-box-flex: 1;
font-size: 14px;
cursor: pointer;
}

.layui-m-layerbtn span[yes] {
color: #40affe;
}

.layui-m-layerbtn span[no] {
border-right: 1px solid #d0d0d0;
border-radius: 0 0 0 5px;
}

.layui-m-layerbtn span:active {
background-color: #f6f6f6;
}

.layui-m-layerend {
position: absolute;
right: 7px;
top: 10px;
width: 30px;
height: 30px;
border: 0;
font-weight: 400;
background: 0 0;
cursor: pointer;
-webkit-appearance: none;
font-size: 30px;
}

.layui-m-layerend::after,
.layui-m-layerend::before {
position: absolute;
left: 5px;
top: 15px;
content: "";
width: 18px;
height: 1px;
background-color: #999;
transform: rotate(45deg);
-webkit-transform: rotate(45deg);
border-radius: 3px;
}

.layui-m-layerend::after {
transform: rotate(-45deg);
-webkit-transform: rotate(-45deg);
}

.layui-m-layer .layui-m-layer-footer {
position: fixed;
width: 95%;
max-width: 100%;
margin: 0 auto;
left: 0;
right: 0;
bottom: 10px;
background: 0 0;
}

.layui-m-layer-footer .layui-m-layercont {
padding: 20px;
border-radius: 5px 5px 0 0;
background-color: rgba(255, 255, 255, 0.8);
}

.layui-m-layer-footer .layui-m-layerbtn {
display: block;
height: auto;
background: 0 0;
border-top: none;
}

.layui-m-layer-footer .layui-m-layerbtn span {
background-color: rgba(255, 255, 255, 0.8);
}

.layui-m-layer-footer .layui-m-layerbtn span[no] {
color: #fd482c;
border-top: 1px solid #c2c2c2;
border-radius: 0 0 5px 5px;
}

.layui-m-layer-footer .layui-m-layerbtn span[yes] {
margin-top: 10px;
border-radius: 5px;
}

.layui-m-layer .layui-m-layer-msg {
width: auto;
max-width: 90%;
margin: 0 auto;
bottom: -150px;
background-color: rgba(0, 0, 0, 0.7);
color: #fff;
}

.layui-m-layer-msg .layui-m-layercont {
padding: 10px 20px;
}

.collection-success {
/*opacity: 0.6;*/
/*background: #EAEAEA;*/
color: #ffffff;
}
.collection-success:hover {
/*opacity: 0.45;*/
/*background: #000000;*/
color: #ffffff;
}
.layui-m-layercont .cyxy-trs-target {
display: none;
}
.collection-icon {
width: 12px;
height: 13px;
background: url("data:image/png;base64,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")
  no-repeat;
display: inline-block;
background-size: cover;
background-position: center;
}
.collection-success > a {
margin-left: 12px;
vertical-align: middle;
}
.cy_free_box {
position: relative;
}
.cy_free_box img {
width: 100%;
cursor: pointer;
-moz-user-select: none; /*火狐*/
-webkit-user-select: none; /*webkit浏览器*/
-ms-user-select: none; /*IE10*/
-khtml-user-select: none; /*早期浏览器*/
user-select: none;
}
.layui-m-layer-cy_free_content {
background: inherit !important;
}
</style></head>
<body>
<h1>WebGL - Frustum Diagram</h1><div class="description">
Drag sliders to change the frustum.
</div>
<div style="position:absolute;">
<canvas id="canvas" width="796" height="1196"></canvas>
<img id="eye" src="resources/eye-icon.png" style="position: absolute; z-index: 2; left: 18px; top: 269px; width: 32px; height: auto;">
</div>
<div id="uiContainer">
<div id="ui">
  <div id="fieldOfView">
    <div class="gman-widget-outer">
      <div class="gman-widget-label">fieldOfView</div>
      <div class="gman-widget-value">30</div>
      <input class="gman-widget-slider" type="range" min="0" max="179" value="30">
    </div>
  </div>
  <div id="zNear">
    <div class="gman-widget-outer">
      <div class="gman-widget-label">zNear</div>
      <div class="gman-widget-value">10</div>
      <input class="gman-widget-slider" type="range" min="1" max="50" value="10">
    </div>
  </div>
  <div id="zFar">
    <div class="gman-widget-outer">
      <div class="gman-widget-label">zFar</div>
      <div class="gman-widget-value">50</div>
      <input class="gman-widget-slider" type="range" min="1" max="50" value="50">
    </div>
  </div>
  <div id="zPosition">
    <div class="gman-widget-outer">
      <div class="gman-widget-label">zPosition</div>
      <div class="gman-widget-value">-25</div>
      <input class="gman-widget-slider" type="range" min="-60" max="1" value="-25">
    </div>
  </div>
</div>
</div>

<!-- Vertex顶点 -->
<script id="vertexColorVertexShader" type="text/something-not-javascript">
attribute vec4 position;
attribute vec4 color;
uniform mat4 u_worldViewProjection;
varying vec4 v_color;
void main() {
gl_Position = u_worldViewProjection * position;
v_color = color;
}

</script>
<!-- Fragment -->
<script id="vertexColorFragmentShader" type="text/something-not-javascript">
precision mediump float;
uniform vec4 u_color;
varying vec4 v_color;
void main() {
gl_FragColor = u_color * v_color;
}
</script>

<!-- Vertex顶点 -->
<script id="baseVertexShader" type="text/something-not-javascript">
attribute vec4 position;
attribute vec4 color;
uniform mat4 u_worldViewProjection;
uniform mat4 u_exampleWorldViewProjection;
varying vec4 v_color;
varying vec4 v_position;
void main() {
gl_Position = u_worldViewProjection * position;
v_position = u_exampleWorldViewProjection * position;
v_position = v_position / v_position.w;
v_color = color;
}

</script>
<!-- Fragment -->
<script id="colorFragmentShader" type="text/something-not-javascript">
precision mediump float;
varying vec4 v_color;
varying vec4 v_position;
uniform vec4 u_color;
void main() {
bool blend = (v_position.x < -1.0 || v_position.x > 1.0 ||
              v_position.y < -1.0 || v_position.y > 1.0 ||
              v_position.z < -1.0 || v_position.z > 1.0);
vec4 blendColor = blend ? vec4(0.35, 0.35, 0.35, 1.0) : vec4(1, 1, 1, 1);
gl_FragColor = v_color * u_color * blendColor;
}
</script>
<!--
for most samples webgl-utils only provides shader compiling/linking and
canvas resizing because why clutter the examples with code that's the same in every sample.
See https://webglfundamentals.org/webgl/lessons/webgl-boilerplate.html
and https://webglfundamentals.org/webgl/lessons/webgl-resizing-the-canvas.html
for webgl-utils, m3, m4, and webgl-lessons-ui.
-->
<script src="resources/webgl-utils.js"></script>
<script src="resources/webgl-lessons-ui.js"></script>
<script src="resources/lessons-helper.js"></script> <!-- you can and should delete this script. it is only used on the site to help with errors -->
<script src="resources/twgl-full.min.js"></script>
<script>
"use strict";

const v3 = twgl.v3;
const m4 = twgl.m4;

var eyePosition;
var target;

// globals
var pixelRatio = window.devicePixelRatio || 1;
var scale = 1;

function main() {
// Get A WebGL context
/** @type {HTMLCanvasElement} */
var canvas = document.querySelector("#canvas");
var gl = canvas.getContext("webgl");
if (!gl) {
  return;
}

const darkColors = {
  lines: [1, 1, 1, 1],
};
const lightColors = {
  lines: [0, 0, 0, 1],
};

// 媒体查询
const darkMatcher = window.matchMedia("(prefers-color-scheme: dark)");

const isDarkMode = darkMatcher.matches;
// 颜色 背景颜色
const colors = isDarkMode ? darkColors : lightColors;


// 眼镜 相机
const eyeElem = document.querySelector("#eye");

// Create Geometry. 创建几何。
// 线立方阵列
var wireCubeArrays = {
  position: [  // 顶点位置
      -1,  1, -1,
       1,  1, -1,
       1, -1, -1,
      -1, -1, -1,

      -1,  1,  1,
       1,  1,  1,
       1, -1,  1,
      -1, -1,  1,
  ],
  color: [  // 颜色
      1, 1, 1, 1,
      1, 1, 1, 1,
      1, 1, 1, 1,
      1, 1, 1, 1,

      1, 1, 1, 1,
      1, 1, 1, 1,
      1, 1, 1, 1,
      1, 1, 1, 1,
  ],
  indices: [ //指数
      0, 1, 1, 2, 2, 3, 3, 0,
      4, 5, 5, 6, 6, 7, 7, 4,
      0, 4, 1, 5, 2, 6, 3, 7,
  ],
};

// 颜色
  // 创建Program 返回 program
var vertexColorProgramInfo = twgl.createProgramInfo(gl, [
    'vertexColorVertexShader',
    'vertexColorFragmentShader',
]);

// 创建 Buffer
var wireCubeBufferInfo = twgl.createBufferInfoFromArrays(gl, wireCubeArrays);

//
var cubeRaysArrays = {
  position: wireCubeArrays.position,
  color: [
      1, 1, 1, 1,
      1, 1, 1, 1,
      1, 1, 1, 1,
      1, 1, 1, 1,

      ...colors.lines,
      ...colors.lines,
      ...colors.lines,
      ...colors.lines,
  ],
  indices: [
      0, 4, 1, 5, 2, 6, 3, 7,
  ],
};
var cubeRaysBufferInfo = twgl.createBufferInfoFromArrays(gl, cubeRaysArrays);

  // 创建Program 返回 program
var colorProgramInfo = twgl.createProgramInfo(gl, [
    'baseVertexShader',
    'colorFragmentShader',
]);
var cubeArrays = twgl.primitives.createCubeVertices(2);
delete cubeArrays.normal;
delete cubeArrays.texcoord;
var faceColors = [
  [ 1, 0, 0, 1, ],
  [ 0, 1, 0, 1, ],
  [ 1, 1, 0, 1, ],
  [ 0, 0, 1, 1, ],
  [ 1, 0, 1, 1, ],
  [ 0, 1, 1, 1, ],
];
var colorVerts = [];
for (var f = 0; f < 6; ++f) {
  for (var v = 0; v < 4; ++v) {
    colorVerts.push(...faceColors[f]);
  }
}
cubeArrays.color = colorVerts;
var cubeBufferInfo = twgl.createBufferInfoFromArrays(gl, cubeArrays);

var fBufferInfo = twgl.createBufferInfoFromArrays(gl, {
  position: [
        // left column front
        0,   0,  0,
        0, 150,  0,
        30,   0,  0,
        0, 150,  0,
        30, 150,  0,
        30,   0,  0,

        // top rung front
        30,   0,  0,
        30,  30,  0,
        100,   0,  0,
        30,  30,  0,
        100,  30,  0,
        100,   0,  0,

        // middle rung front
        30,  60,  0,
        30,  90,  0,
        67,  60,  0,
        30,  90,  0,
        67,  90,  0,
        67,  60,  0,

        // left column back
          0,   0,  30,
         30,   0,  30,
          0, 150,  30,
          0, 150,  30,
         30,   0,  30,
         30, 150,  30,

        // top rung back
         30,   0,  30,
        100,   0,  30,
         30,  30,  30,
         30,  30,  30,
        100,   0,  30,
        100,  30,  30,

        // middle rung back
         30,  60,  30,
         67,  60,  30,
         30,  90,  30,
         30,  90,  30,
         67,  60,  30,
         67,  90,  30,

        // top
          0,   0,   0,
        100,   0,   0,
        100,   0,  30,
          0,   0,   0,
        100,   0,  30,
          0,   0,  30,

        // top rung right
        100,   0,   0,
        100,  30,   0,
        100,  30,  30,
        100,   0,   0,
        100,  30,  30,
        100,   0,  30,

        // under top rung
        30,   30,   0,
        30,   30,  30,
        100,  30,  30,
        30,   30,   0,
        100,  30,  30,
        100,  30,   0,

        // between top rung and middle
        30,   30,   0,
        30,   60,  30,
        30,   30,  30,
        30,   30,   0,
        30,   60,   0,
        30,   60,  30,

        // top of middle rung
        30,   60,   0,
        67,   60,  30,
        30,   60,  30,
        30,   60,   0,
        67,   60,   0,
        67,   60,  30,

        // right of middle rung
        67,   60,   0,
        67,   90,  30,
        67,   60,  30,
        67,   60,   0,
        67,   90,   0,
        67,   90,  30,

        // bottom of middle rung.
        30,   90,   0,
        30,   90,  30,
        67,   90,  30,
        30,   90,   0,
        67,   90,  30,
        67,   90,   0,

        // right of bottom
        30,   90,   0,
        30,  150,  30,
        30,   90,  30,
        30,   90,   0,
        30,  150,   0,
        30,  150,  30,

        // bottom
        0,   150,   0,
        0,   150,  30,
        30,  150,  30,
        0,   150,   0,
        30,  150,  30,
        30,  150,   0,

        // left side
        0,   0,   0,
        0,   0,  30,
        0, 150,  30,
        0,   0,   0,
        0, 150,  30,
        0, 150,   0,
  ],
  color: {
    numComponents: 3,
    data: new Uint8Array([
          // left column front
        200,  70, 120,
        200,  70, 120,
        200,  70, 120,
        200,  70, 120,
        200,  70, 120,
        200,  70, 120,

          // top rung front
        200,  70, 120,
        200,  70, 120,
        200,  70, 120,
        200,  70, 120,
        200,  70, 120,
        200,  70, 120,

          // middle rung front
        200,  70, 120,
        200,  70, 120,
        200,  70, 120,
        200,  70, 120,
        200,  70, 120,
        200,  70, 120,

          // left column back
        80, 70, 200,
        80, 70, 200,
        80, 70, 200,
        80, 70, 200,
        80, 70, 200,
        80, 70, 200,

          // top rung back
        80, 70, 200,
        80, 70, 200,
        80, 70, 200,
        80, 70, 200,
        80, 70, 200,
        80, 70, 200,

          // middle rung back
        80, 70, 200,
        80, 70, 200,
        80, 70, 200,
        80, 70, 200,
        80, 70, 200,
        80, 70, 200,

          // top
        70, 200, 210,
        70, 200, 210,
        70, 200, 210,
        70, 200, 210,
        70, 200, 210,
        70, 200, 210,

          // top rung right
        200, 200, 70,
        200, 200, 70,
        200, 200, 70,
        200, 200, 70,
        200, 200, 70,
        200, 200, 70,

          // under top rung
        210, 100, 70,
        210, 100, 70,
        210, 100, 70,
        210, 100, 70,
        210, 100, 70,
        210, 100, 70,

          // between top rung and middle
        210, 160, 70,
        210, 160, 70,
        210, 160, 70,
        210, 160, 70,
        210, 160, 70,
        210, 160, 70,

          // top of middle rung
        70, 180, 210,
        70, 180, 210,
        70, 180, 210,
        70, 180, 210,
        70, 180, 210,
        70, 180, 210,

          // right of middle rung
        100, 70, 210,
        100, 70, 210,
        100, 70, 210,
        100, 70, 210,
        100, 70, 210,
        100, 70, 210,

          // bottom of middle rung.
        76, 210, 100,
        76, 210, 100,
        76, 210, 100,
        76, 210, 100,
        76, 210, 100,
        76, 210, 100,

          // right of bottom
        140, 210, 80,
        140, 210, 80,
        140, 210, 80,
        140, 210, 80,
        140, 210, 80,
        140, 210, 80,

          // bottom
        90, 130, 110,
        90, 130, 110,
        90, 130, 110,
        90, 130, 110,
        90, 130, 110,
        90, 130, 110,

          // left side
        160, 160, 220,
        160, 160, 220,
        160, 160, 220,
        160, 160, 220,
        160, 160, 220,
        160, 160, 220,
    ]),
  },
});

// pre-allocate a bunch of arrays
var projection = new Float32Array(16);
var exampleProjection = new Float32Array(16);
var exampleInverseProjection = new Float32Array(16);
var view = new Float32Array(16);
var world = new Float32Array(16);
var viewProjection = new Float32Array(16);
eyePosition = new Float32Array([31, 17, 15]);
var worldViewProjection = new Float32Array(16);
var exampleWorldViewProjection = new Float32Array(16);
target = new Float32Array([23, 16, 0]);
var up = new Float32Array([0, 1, 0]);
var v3t0 = new Float32Array(3);
var zeroMat = new Float32Array(16);

var targetToEye = new Float32Array(3);
v3.subtract(eyePosition, target, targetToEye);

// uniforms.
var sharedUniforms = {
};

var sceneCubeUniforms = {
  u_color: [1, 1, 1, 1],
  u_worldViewProjection: worldViewProjection,
  u_exampleWorldViewProjection: exampleWorldViewProjection,
};

var frustumCubeUniforms = {
  u_color: [1, 1, 1, 0.4],
  u_worldViewProjection: worldViewProjection,
  u_exampleWorldViewProjection: zeroMat,
};

var cubeRaysUniforms = {
  u_color: colors.lines,
  u_worldViewProjection: worldViewProjection,
};

var wireFrustumUniforms = {
  u_color: colors.lines,
  u_worldViewProjection: worldViewProjection,
};

var zNear = 10;
var zFar = 50;
var fieldOfView = 30;
var zPosition = -25;

// Setup a ui.
function updateFieldOfView(event, ui) {
  fieldOfView = ui.value;
}

function updateZNear(event, ui) {
  zNear = ui.value;
}

function updateZFar(event, ui) {
  zFar = ui.value;
}

function updateZPosition(event, ui) {
  zPosition = ui.value;
}

webglLessonsUI.setupSlider("#fieldOfView", {value: fieldOfView, slide: updateFieldOfView, max: 179});
webglLessonsUI.setupSlider("#zNear", {value: zNear, slide: updateZNear, min: 1, max: 50});
webglLessonsUI.setupSlider("#zFar", {value: zFar, slide: updateZFar, min: 1, max: 50});
webglLessonsUI.setupSlider("#zPosition", {value: zPosition, slide: updateZPosition, min: -60, max: 0});

function render(time) {
  time *= 0.001;

  twgl.resizeCanvasToDisplaySize(canvas, pixelRatio);
  const halfHeight = gl.canvas.height / 2;
  const width = gl.canvas.width;

  // clear the screen.
  gl.disable(gl.SCISSOR_TEST);
  gl.colorMask(true, true, true, true);
  gl.clearColor(0, 0, 0, 0);
  gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

  gl.viewport(0, halfHeight, width, halfHeight);

  gl.enable(gl.DEPTH_TEST);
  gl.enable(gl.BLEND);
  gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);

  var aspect = gl.canvas.clientWidth / (gl.canvas.clientHeight / 2);

  m4.perspective(
      degToRad(60),
      aspect,
      1,
      5000,
      projection);

  var f = Math.max(30, fieldOfView) - 30;
  f = f / (179 - 30);
  f = f * f * f * f;
  f = lerp(1, 179 * 0.9, f);
  f = 1;
  v3.mulScalar(targetToEye, f, v3t0);
  v3.add(v3t0, target, v3t0);
  m4.lookAt(
      v3t0, //eyePosition,
      target,
      up,
      view);
  m4.inverse(view, view);
  m4.multiply(projection, view, viewProjection);

  // Draw scene
  function drawScene(viewProjection, exampleProjection) {
    gl.useProgram(colorProgramInfo.program);
    twgl.setBuffersAndAttributes(gl, colorProgramInfo, cubeBufferInfo);
    var cubeScale = scale * 3;
    for (var ii = -1; ii <= 1; ++ii) {
      m4.translation([ii * 10, 0, zPosition], world);
      m4.rotateY(world, time + ii * Math.PI / 6, world);
      m4.rotateX(world, Math.PI / 4, world);
      m4.rotateZ(world, Math.PI / 4, world);
      m4.scale(world, [cubeScale, cubeScale, cubeScale], world);
      m4.multiply(viewProjection, world, worldViewProjection);

      m4.multiply(exampleProjection, world, exampleWorldViewProjection);

      twgl.setUniforms(colorProgramInfo, sceneCubeUniforms);
      twgl.drawBufferInfo(gl, cubeBufferInfo);
    }

    var rotation = [degToRad(40), degToRad(25), degToRad(325)];
    m4.translation([45, 150, 0], world);
    m4.rotateX(world, rotation[0], world);
    m4.rotateY(world, rotation[1], world);
    m4.rotateZ(world, rotation[2], world);
    m4.multiply(viewProjection, world, worldViewProjection);
    m4.multiply(exampleProjection, world, exampleWorldViewProjection);
    twgl.setBuffersAndAttributes(gl, colorProgramInfo, fBufferInfo);
    twgl.setUniforms(colorProgramInfo, sceneCubeUniforms);
    twgl.drawBufferInfo(gl, fBufferInfo);
  }
  drawScene(viewProjection, exampleProjection);

  // Draw Frustum Cube behind
  function drawFrustumCube() {
    gl.useProgram(colorProgramInfo.program);
    twgl.setBuffersAndAttributes(gl, colorProgramInfo, cubeBufferInfo);
    m4.perspective(
        degToRad(fieldOfView),
        aspect,
        zNear,
        zFar * scale,
        exampleProjection);
    m4.inverse(exampleProjection, exampleInverseProjection);

    m4.translation([0, 0, 0], world);
    m4.multiply(exampleInverseProjection, world, world);
    m4.scale(world, [scale, scale, scale], world);
    m4.multiply(viewProjection, world, worldViewProjection);

    twgl.setUniforms(colorProgramInfo, sharedUniforms);
    twgl.setUniforms(colorProgramInfo, frustumCubeUniforms);
    twgl.drawBufferInfo(gl, cubeBufferInfo);
  }
  gl.enable(gl.CULL_FACE);
  gl.cullFace(gl.BACK);
  drawFrustumCube();
  gl.disable(gl.CULL_FACE);

  gl.enable(gl.CULL_FACE);
  gl.cullFace(gl.FRONT);
//    drawFrustumCube();
  gl.disable(gl.CULL_FACE);

  // Draw view cone.
  m4.perspective(
      degToRad(fieldOfView),
      aspect,
      1,
      5000,
      exampleProjection);
  m4.inverse(exampleProjection, exampleInverseProjection);

  m4.translation([0, 0, 0], world);
  m4.multiply(world, exampleInverseProjection, world);
  m4.scale(world, [scale, scale, scale], world);
  m4.multiply(viewProjection, world, worldViewProjection);

  gl.useProgram(vertexColorProgramInfo.program);
  twgl.setBuffersAndAttributes(gl, vertexColorProgramInfo, cubeRaysBufferInfo);
  twgl.setUniforms(vertexColorProgramInfo, sharedUniforms);
  twgl.setUniforms(vertexColorProgramInfo, cubeRaysUniforms);
  twgl.drawBufferInfo(gl, cubeRaysBufferInfo, gl.LINES);

  {
    const eyePosition = m4.transformPoint(worldViewProjection, [0, 0, 0]);
    const ex = (eyePosition[0] *  .5 + .5) * width / pixelRatio;
    const ey = (eyePosition[1] * -.5 + .5) * halfHeight / pixelRatio;
    eyeElem.style.left = px(ex - eyeElem.width / 2);
    eyeElem.style.top = px(ey - eyeElem.height / 2);
  }


  // Draw Frustum Wire
  m4.perspective(
      degToRad(fieldOfView),
      aspect,
      zNear,
      zFar * scale,
      exampleProjection);
  m4.inverse(exampleProjection, exampleInverseProjection);

  m4.translation([0, 0, 0], world);
  m4.multiply(world, exampleInverseProjection, world);
  m4.scale(world, [scale, scale, scale], world);
  m4.multiply(viewProjection, world, worldViewProjection);

  twgl.setBuffersAndAttributes(gl, vertexColorProgramInfo, wireCubeBufferInfo);
  twgl.setUniforms(vertexColorProgramInfo, sharedUniforms);
  twgl.setUniforms(vertexColorProgramInfo, wireFrustumUniforms);
  twgl.drawBufferInfo(gl, wireCubeBufferInfo, gl.LINES);

  // Draw 3D view
  gl.enable(gl.SCISSOR_TEST);
  gl.viewport(0, 0, width, halfHeight);
  gl.scissor(0, 0, width, halfHeight);
  gl.clearColor(0.5, 0.5, 0.5, 1);
  gl.clear(gl.COLOR_BUFFER_BIT);

  m4.perspective(
      degToRad(fieldOfView),
      aspect,
      zNear,
      zFar * scale,
      projection);
  drawScene(exampleProjection, zeroMat);

  requestAnimationFrame(render);
}

requestAnimationFrame(render);
}

function px(v) {
return `${v | 0}px`;
}

function degToRad(deg) {
return deg * Math.PI / 180;
}

function lerp(a, b, l) {
 return a + (b - a) * l;
}

main();
</script>




<div style="position: static; width: 0px; height: 0px; border: none; padding: 0px; margin: 0px;"><div id="trans-tooltip"><div id="tip-left-top" style="background: url(&quot;chrome-extension://ccfjcepmiaackkccabgeeegeklgifffd/imgs/map/tip-left-top.png&quot;);"></div><div id="tip-top" style="background: url(&quot;chrome-extension://ccfjcepmiaackkccabgeeegeklgifffd/imgs/map/tip-top.png&quot;) repeat-x;"></div><div id="tip-right-top" style="background: url(&quot;chrome-extension://ccfjcepmiaackkccabgeeegeklgifffd/imgs/map/tip-right-top.png&quot;);"></div><div id="tip-right" style="background: url(&quot;chrome-extension://ccfjcepmiaackkccabgeeegeklgifffd/imgs/map/tip-right.png&quot;) repeat-y;"></div><div id="tip-right-bottom" style="background: url(&quot;chrome-extension://ccfjcepmiaackkccabgeeegeklgifffd/imgs/map/tip-right-bottom.png&quot;);"></div><div id="tip-bottom" style="background: url(&quot;chrome-extension://ccfjcepmiaackkccabgeeegeklgifffd/imgs/map/tip-bottom.png&quot;) repeat-x;"></div><div id="tip-left-bottom" style="background: url(&quot;chrome-extension://ccfjcepmiaackkccabgeeegeklgifffd/imgs/map/tip-left-bottom.png&quot;);"></div><div id="tip-left" style="background: url(&quot;chrome-extension://ccfjcepmiaackkccabgeeegeklgifffd/imgs/map/tip-left.png&quot;);"></div><div id="trans-content"></div></div><div id="tip-arrow-bottom" style="background: url(&quot;chrome-extension://ccfjcepmiaackkccabgeeegeklgifffd/imgs/map/tip-arrow-bottom.png&quot;);"></div><div id="tip-arrow-top" style="background: url(&quot;chrome-extension://ccfjcepmiaackkccabgeeegeklgifffd/imgs/map/tip-arrow-top.png&quot;);"></div></div></body></html>